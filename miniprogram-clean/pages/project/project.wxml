<!-- pages/project/project.wxml -->
<view class="container">

  <!-- é¡¹ç›®å¤´éƒ¨ -->
  <view class="project-header">
    <view class="project-name">{{project.name}}</view>
    <view class="project-meta">
      <view class="category">{{project.category}}</view>
      <view class="difficulty {{project.difficulty}}">
        {{project.difficulty === 'easy' ? 'ç®€å•' : project.difficulty === 'hard' ? 'å›°éš¾' : 'ä¸­ç­‰'}}
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€åˆ‡æ¢ -->
  <view class="status-section">
    <view class="section-title">é¡¹ç›®çŠ¶æ€</view>
    <view class="status-options">
      <view
        class="status-option {{project.status === item.value ? 'active' : ''}}"
        wx:for="{{statusOptions}}" wx:key="value"
        style="border-color: {{item.color}}; color: {{project.status === item.value ? item.color : '#94a3b8'}}"
        bindtap="changeStatus"
        data-status="{{item.value}}">
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- å®Œæˆè¿›åº¦ï¼ˆç¯å½¢è¿›åº¦å›¾ï¼‰ -->
  <view class="progress-section">
    <view class="section-title">
      <text>å®Œæˆè¿›åº¦</text>
      <view class="edit-progress" bindtap="startEditProgress" wx:if="{{!editingProgress}}">âœï¸ ç¼–è¾‘</view>
    </view>
    <view class="progress-display" wx:if="{{!editingProgress}}">
      <canvas canvas-id="progressCanvas" style="width:120px;height:120px;" />
    </view>
    <view class="progress-edit" wx:else>
      <slider class="progress-slider" value="{{tempProgress}}" min="0" max="100" step="5" show-value bindchange="onProgressChange" />
      <view class="edit-btns">
        <button class="btn-cancel-small" bindtap="cancelEditProgress">å–æ¶ˆ</button>
        <button class="btn-save-small" bindtap="saveProgress">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- å¯¼å¸ˆå…³ç³»å›¾ï¼ˆCanvasï¼‰ -->
  <view class="mentors-section">
    <view class="section-title">
      <text>å‚ä¸å¯¼å¸ˆ ({{relatedMentors.length}})</text>
      <view class="add-mentor" bindtap="showAddMentor">+ æ·»åŠ </view>
    </view>
    <view class="mentors-graph" wx:if="{{relatedMentors.length > 0}}">
      <canvas canvas-id="graphCanvas" style="width:300px;height:300px;" />
    </view>
    <view class="empty-mentors" wx:else>
      <view class="empty-icon">ğŸ‘¨â€ğŸ«</view>
      <view class="empty-text">æš‚æ— å¯¼å¸ˆå‚ä¸</view>
      <button class="btn-add-first" bindtap="showAddMentor">æ·»åŠ ç¬¬ä¸€ä½å¯¼å¸ˆ</button>
    </view>
  </view>

  <!-- é¡¹ç›®æè¿° -->
  <view class="desc-section">
    <view class="section-title">é¡¹ç›®æè¿°</view>
    <view class="desc-text">{{project.description || 'æš‚æ— æè¿°'}}</view>
  </view>

  <!-- ç›¸å…³å¯¹è¯ -->
  <view class="chats-section" wx:if="{{projectChats.length > 0}}">
    <view class="section-title">é¡¹ç›®ç›¸å…³å¯¹è¯</view>
    <view class="chat-list">
      <view class="chat-item" wx:for="{{projectChats}}" wx:key="mentorName">
        <view class="chat-mentor">{{item.mentorName}}</view>
        <view class="chat-message">{{item.lastMessage}}</view>
        <view class="chat-date">{{item.date}}</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œåŒº -->
  <view class="actions-section">
    <button class="btn-delete-project" bindtap="deleteProject">ğŸ—‘ï¸ åˆ é™¤é¡¹ç›®</button>
  </view>

  <!-- å¯¼å¸ˆé€‰æ‹©å™¨ï¼ˆå¼¹çª—ï¼‰ -->
  <view class="mentor-modal" wx:if="{{showMentorPicker}}">
    <view class="modal-mask" bindtap="hideAddMentor"></view>
    <view class="modal-content">
      <view class="modal-title">é€‰æ‹©å¯¼å¸ˆ</view>
      <scroll-view class="mentor-list" scroll-y>
        <view class="mentor-option" wx:for="{{allMentors}}" wx:key="id" bindtap="addMentor" data-id="{{item.id}}">
          <view class="mentor-avatar-option">{{item.avatar}}</view>
          <view class="mentor-info-option">
            <view class="mentor-name-option">{{item.name}}</view>
            <view class="mentor-field-option">{{item.field}}</view>
          </view>
        </view>
        <view class="empty-list" wx:if="{{allMentors.length === 0}}">
          <view class="empty-text">æš‚æ— å¯ç”¨å¯¼å¸ˆ</view>
          <button class="btn-create-mentor" bindtap="hideAddMentor">å»åˆ›å»ºå¯¼å¸ˆ</button>
        </view>
      </scroll-view>
      <button class="btn-close-modal" bindtap="hideAddMentor">å…³é—­</button>
    </view>
  </view>

</view>
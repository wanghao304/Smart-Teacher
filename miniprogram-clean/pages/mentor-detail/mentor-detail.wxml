<!-- pages/mentor-detail/mentor-detail.wxml -->
<view class="container">
  
  <!-- å¯¼å¸ˆå¤´éƒ¨å¡ç‰‡ -->
  <view class="mentor-header">
    <view class="avatar-section">
      <view class="avatar-circle" bindtap="{{editing ? 'showAvatarSelector' : ''}}">
        {{mentor.avatar}}
        <view class="edit-icon" wx:if="{{editing}}">âœï¸</view>
      </view>
      
      <view class="mentor-basic">
        <input 
          wx:if="{{editing}}"
          class="name-input"
          value="{{editData.name}}"
          bindinput="onInputChange"
          data-field="name"
          placeholder="å¯¼å¸ˆå§“å"
        />
        <view wx:else class="mentor-name">{{mentor.name}}</view>
        
        <input 
          wx:if="{{editing}}"
          class="field-input"
          value="{{editData.field}}"
          bindinput="onInputChange"
          data-field="field"
          placeholder="æ“…é•¿é¢†åŸŸ"
        />
        <view wx:else class="mentor-field">{{mentor.field}}</view>
      </view>
    </view>

    <view class="type-tag">{{mentor.type === 'celebrity' ? 'åäººå¯¼å¸ˆ' : mentor.type === 'custom' ? 'è‡ªå®šä¹‰' : 'AIæ¨è'}}</view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-title">ğŸ“Š äº’åŠ¨æ•°æ®</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{stats.chatCount}}</view>
        <view class="stat-label">å¯¹è¯æ¬¡æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{stats.totalMessages}}</view>
        <view class="stat-label">æ¶ˆæ¯æ€»æ•°</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{stats.avgResponseTime}}s</view>
        <view class="stat-label">å¹³å‡å“åº”</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{stats.lastChatDate}}</view>
        <view class="stat-label">æœ€è¿‘å¯¹è¯</view>
      </view>
    </view>
  </view>

  <!-- å…³é”®è¯é¢˜ -->
  <view class="topics-section" wx:if="{{keyTopics.length > 0}}">
    <view class="section-title">ğŸ’¬ å…³é”®è¯é¢˜</view>
    <view class="topics-list">
      <view class="topic-item" wx:for="{{keyTopics}}" wx:key="name">
        <view class="topic-name">{{item.name}}</view>
        <view class="topic-count">{{item.count}}æ¬¡</view>
        <view class="topic-trend {{item.trend}}">
          {{item.trend === 'up' ? 'â†‘' : item.trend === 'down' ? 'â†“' : 'â†’'}}
        </view>
      </view>
    </view>
  </view>

  <!-- èƒŒæ™¯ä»‹ç» -->
  <view class="info-section">
    <view class="section-title">ğŸ“ èƒŒæ™¯ä»‹ç»</view>
    <textarea 
      wx:if="{{editing}}"
      class="background-input"
      value="{{editData.background}}"
      bindinput="onInputChange"
      data-field="background"
      placeholder="å¯¼å¸ˆçš„èƒŒæ™¯ä»‹ç»..."
      maxlength="500"
    ></textarea>
    <view wx:else class="background-text">{{mentor.background || 'æš‚æ— ä»‹ç»'}}</view>
  </view>

  <!-- æ ¸å¿ƒæ–¹æ³•è®º -->
  <view class="methodology-section">
    <view class="section-title">ğŸ¯ æ ¸å¿ƒæ–¹æ³•è®º</view>
    <textarea 
      wx:if="{{editing}}"
      class="methodology-input"
      value="{{editData.methodology}}"
      bindinput="onInputChange"
      data-field="methodology"
      placeholder="å¯¼å¸ˆçš„æ ¸å¿ƒæ–¹æ³•è®º..."
      maxlength="500"
    ></textarea>
    <view wx:else class="methodology-text" bindtap="viewMethodology">
      {{mentor.methodology || 'æš‚æ— æ–¹æ³•è®º'}}
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒº -->
  <view class="actions-section">
    <view class="section-title">âš™ï¸ æ“ä½œ</view>
    
    <!-- ç¼–è¾‘æ¨¡å¼æŒ‰é’® -->
    <view class="action-btns" wx:if="{{editing}}">
      <button class="btn-cancel" bindtap="cancelEdit">å–æ¶ˆ</button>
      <button class="btn-save" bindtap="saveEdit">ä¿å­˜ä¿®æ”¹</button>
    </view>
    
    <!-- æ­£å¸¸æ¨¡å¼æŒ‰é’® -->
    <view class="action-btns" wx:else>
      <button class="btn-edit" bindtap="startEdit">ğŸ“ ç¼–è¾‘èµ„æ–™</button>
      <button class="btn-export" bindtap="exportChat">ğŸ’¾ å¯¼å‡ºèŠå¤©</button>
      <button class="btn-delete" bindtap="deleteMentor">ğŸ—‘ï¸ åˆ é™¤å¯¼å¸ˆ</button>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¹è¯æŒ‰é’® -->
  <view class="footer-chat" wx:if="{{!editing}}">
    <button class="btn-chat" bindtap="startChat">
      ğŸ’¬ å¼€å§‹å¯¹è¯
    </button>
  </view>

  <!-- å¤´åƒé€‰æ‹©å™¨ -->
  <view class="avatar-modal" wx:if="{{showAvatarPicker}}">
    <view class="modal-mask" bindtap="hideAvatarSelector"></view>
    <view class="modal-content">
      <view class="modal-title">é€‰æ‹©å¤´åƒ</view>
      
      <view class="avatar-grid">
        <view 
          class="avatar-option"
          wx:for="{{avatarEmojis}}" wx:key="*this"
          bindtap="selectAvatar"
          data-avatar="{{item}}"
        >
          {{item}}
        </view>
      </view>

      <button class="btn-upload" bindtap="uploadAvatar">ğŸ“· ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡</button>
      <button class="btn-close" bindtap="hideAvatarSelector">å…³é—­</button>
    </view>
  </view>

</view>
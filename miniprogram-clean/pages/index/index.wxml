<!-- pages/index/index.wxml -->
<view class="container">

  <!-- BåŒºï¼šæ•°æ®ç»Ÿè®¡åŒº -->
  <view class="stats-section">
    <view class="stat-card" bindtap="navToProjects" data-type="all">
      <view class="stat-value">{{stats.totalProjects}}</view>
      <view class="stat-label">é¡¹ç›®æ€»æ•°</view>
    </view>

    <view class="stat-card" bindtap="navToMentors">
      <view class="stat-value">{{stats.totalMentors}}</view>
      <view class="stat-label">å¯¼å¸ˆæ€»æ•°</view>
    </view>

    <view class="stat-card" bindtap="navToProjects" data-type="success">
      <view class="stat-value success">{{stats.successProjects}}</view>
      <view class="stat-label">æˆåŠŸé¡¹ç›®</view>
    </view>

    <view class="stat-card" bindtap="navToProjects" data-type="failed">
      <view class="stat-value failed">{{stats.failedProjects}}</view>
      <view class="stat-label">å¤±è´¥é¡¹ç›®</view>
    </view>

    <view class="stat-card" bindtap="navToProjects" data-type="abandoned">
      <view class="stat-value abandoned">{{stats.abandonedProjects}}</view>
      <view class="stat-label">æ”¾å¼ƒé¡¹ç›®</view>
    </view>

    <view class="stat-card">
      <view class="stat-value">{{stats.studyDays}}</view>
      <view class="stat-label">å­¦ä¹ å¤©æ•°</view>
    </view>
  </view>

  <!-- AåŒºï¼šå½“å‰é¡¹ç›®å±•ç¤º -->
  <view class="project-section">
    <view class="section-title">å½“å‰æ‰§è¡Œé¡¹ç›®</view>
    
    <view class="project-card" wx:if="{{currentProject}}" bindtap="viewProjectDetail">
      <view class="project-header">
        <view class="project-name">{{currentProject.name}}</view>
        <view class="project-status active">è¿›è¡Œä¸­</view>
      </view>
      
      <view class="project-progress">
        <view class="progress-label">
          <text>é¡¹ç›®è¿›åº¦</text>
          <text class="progress-percent">{{currentProject.progress || 0}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{currentProject.progress || 0}}%"></view>
        </view>
      </view>

      <view class="project-mentors" wx:if="{{currentProject.mentors}}">
        <view class="mentor-label">å‚ä¸å¯¼å¸ˆ</view>
        <view class="mentor-avatars">
          <view class="mentor-avatar" wx:for="{{currentProject.mentors}}" wx:key="id">
            {{item.name.substring(0,1)}}
          </view>
        </view>
      </view>

      <view class="project-footer">
        <text class="project-time">åˆ›å»ºäº {{currentProject.createdAt}}</text>
        <text class="project-arrow">æŸ¥çœ‹è¯¦æƒ… â€º</text>
      </view>
    </view>

    <view class="empty-project" wx:else>
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— è¿›è¡Œä¸­çš„é¡¹ç›®</view>
      <button class="btn-create-project" bindtap="createProject">æ–°å»ºé¡¹ç›®</button>
    </view>
  </view>

  <!-- CåŒºï¼šå¿«æ·æ“ä½œåŒº -->
  <view class="quick-actions">
    <view class="action-btn" bindtap="createMentor">
      <view class="action-icon">ğŸ‘¨â€ğŸ«</view>
      <view class="action-text">æ–°å»ºå¯¼å¸ˆ</view>
    </view>

    <view class="action-btn" bindtap="updateProfile">
      <view class="action-icon">ğŸ“</view>
      <view class="action-text">æ›´æ–°èµ„æ–™</view>
    </view>

    <view class="action-btn" bindtap="createProject">
      <view class="action-icon">â•</view>
      <view class="action-text">æ–°å»ºé¡¹ç›®</view>
    </view>

    <view class="action-btn" bindtap="navToProjects" data-type="all">
      <view class="action-icon">ğŸ“Š</view>
      <view class="action-text">æ‰€æœ‰é¡¹ç›®</view>
    </view>

    <view class="action-btn" bindtap="navToMentors">
      <view class="action-icon">ğŸ‘¥</view>
      <view class="action-text">å¯¼å¸ˆå›¢é˜Ÿ</view>
    </view>
  </view>

  <!-- DåŒºï¼šå¯¹è¯æ¡†åŒº -->
  <view class="chat-section">
    <view class="chat-header">
      <picker class="mentor-picker" range="{{mentors}}" range-key="name" bindchange="selectMentor" wx:if="{{mentors.length > 0}}">
        <view class="picker-content">
          <view class="selected-mentor">
            <view class="mentor-icon">ğŸ’¬</view>
            <text>{{selectedMentor ? selectedMentor.name : 'é€‰æ‹©å¯¼å¸ˆ'}}</text>
          </view>
          <view class="picker-arrow">â–¼</view>
        </view>
      </picker>

      <view class="mentor-empty" wx:else>
        <text class="empty-hint">æš‚æ— å¯¼å¸ˆï¼Œ</text>
        <text class="link" bindtap="createMentor">å»æ·»åŠ  â€º</text>
      </view>
    </view>

    <view class="chat-input-wrapper">
      <view class="input-container">
        <input 
          class="chat-input" 
          wx:if="{{inputMode === 'text'}}"
          placeholder="ä¸å¯¼å¸ˆå¯¹è¯..."
          value="{{messageContent}}"
          bindinput="onMessageInput"
          confirm-type="send"
          bindconfirm="sendMessage"
        />
        <view class="voice-btn" wx:else>
          <text>æŒ‰ä½è¯´è¯</text>
        </view>
      </view>

      <view class="input-tools">
        <view class="tool-btn" bindtap="toggleInputMode">
          <text wx:if="{{inputMode === 'text'}}">ğŸ¤</text>
          <text wx:else>âŒ¨ï¸</text>
        </view>

        <view class="tool-btn" bindtap="uploadAttachment">
          <text>â•</text>
        </view>

        <view class="send-btn" bindtap="sendMessage" wx:if="{{messageContent}}">
          å‘é€
        </view>
      </view>
    </view>
  </view>

</view>

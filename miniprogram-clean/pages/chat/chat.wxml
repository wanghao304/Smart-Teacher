<!-- pages/chat/chat.wxml -->
<view class="container">
  
  <!-- é¡¹ç›®ä¸Šä¸‹æ–‡æç¤º -->
  <view class="project-banner" wx:if="{{project}}">
    <view class="banner-icon">ğŸ“‹</view>
    <view class="banner-text">å½“å‰é¡¹ç›®ï¼š{{project.name}}</view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view 
    class="messages-container"
    scroll-y
    scroll-into-view="{{scrollToView}}"
    scroll-with-animation
  >
    
    <!-- å¿«æ·é—®é¢˜ï¼ˆé¦–æ¬¡å¯¹è¯ï¼‰ -->
    <view class="quick-questions" wx:if="{{showQuickQuestions}}">
      <view class="quick-title">ğŸ‘‹ ä½ å¯ä»¥é—®æˆ‘ï¼š</view>
      <view 
        class="quick-item"
        wx:for="{{quickQuestions}}" wx:key="*this"
        bindtap="selectQuickQuestion"
        data-question="{{item}}"
      >
        {{item}}
      </view>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <view 
      class="message-wrapper {{item.role}}"
      wx:for="{{messages}}" wx:key="id"
      id="msg-{{index}}"
      bindlongpress="onLongPress"
      data-index="{{index}}"
    >
      <!-- ç”¨æˆ·æ¶ˆæ¯ -->
      <view class="message user-message" wx:if="{{item.role === 'user'}}">
        <view class="message-content">{{item.content}}</view>
        <view class="message-avatar">ğŸ‘¤</view>
      </view>

      <!-- AIæ¶ˆæ¯ -->
      <view class="message ai-message" wx:else>
        <view class="message-avatar">{{mentor.avatar}}</view>
        <view class="message-content">{{item.content}}</view>
      </view>

      <view class="message-time">{{item.timestamp}}</view>
    </view>

    <!-- AIè¾“å…¥ä¸­... -->
    <view class="message-wrapper assistant" wx:if="{{aiTyping}}">
      <view class="message ai-message">
        <view class="message-avatar">{{mentor.avatar}}</view>
        <view class="message-content typing">
          <view class="typing-dot"></view>
          <view class="typing-dot"></view>
          <view class="typing-dot"></view>
        </view>
      </view>
    </view>

    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area">
    <view class="input-wrapper">
      
      <!-- åŠŸèƒ½èœå•æŒ‰é’® -->
      <view class="tool-btn" bindtap="showActionMenu">
        <text>â•</text>
      </view>

      <!-- æ–‡å­—è¾“å…¥ -->
      <view class="input-container" wx:if="{{inputMode === 'text'}}">
        <input 
          class="message-input"
          placeholder="è¾“å…¥æ¶ˆæ¯..."
          value="{{inputText}}"
          bindinput="onInputChange"
          confirm-type="send"
          bindconfirm="sendMessage"
        />
      </view>

      <!-- è¯­éŸ³è¾“å…¥ -->
      <view class="voice-container" wx:else>
        <view 
          class="voice-btn"
          bindtouchstart="startVoiceRecord"
          bindtouchend="endVoiceRecord"
        >
          æŒ‰ä½è¯´è¯
        </view>
      </view>

      <!-- åˆ‡æ¢è¾“å…¥æ¨¡å¼ -->
      <view class="tool-btn" bindtap="toggleInputMode">
        <text wx:if="{{inputMode === 'text'}}">ğŸ¤</text>
        <text wx:else>âŒ¨ï¸</text>
      </view>

      <!-- å‘é€æŒ‰é’® -->
      <view 
        class="send-btn {{inputText ? 'active' : ''}}"
        bindtap="sendMessage"
        wx:if="{{inputMode === 'text' && inputText}}"
      >
        å‘é€
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="action-menu" wx:if="{{showMenu}}">
    <view class="menu-mask" bindtap="hideActionMenu"></view>
    <view class="menu-content">
      <view class="menu-title">é€‰æ‹©æ“ä½œ</view>
      <view 
        class="menu-item"
        wx:for="{{menuOptions}}" wx:key="action"
        bindtap="handleMenuAction"
        data-action="{{item.action}}"
      >
        <view class="menu-icon">{{item.icon}}</view>
        <view class="menu-label">{{item.label}}</view>
      </view>
      <button class="menu-close" bindtap="hideActionMenu">å–æ¶ˆ</button>
    </view>
  </view>

</view>
